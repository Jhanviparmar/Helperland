@using Microsoft.AspNetCore.Http;
@model IEnumerable<Helperland.Models.CustomModel>
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="~/css/AdminStyle.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <title>Admin | Helperland</title>
</head>
<body>
    <header>
        <div class="header navbar d-flex flex-md-row flex-column align-items-center">
            <div class="d-flex">
                <button class="navbar-toggler ps-0 ms-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-list" aria-controls="navbar-list" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon ps-0"></span>
                </button>
                <h1 class="title1 ps-4">helperland</h1>
            </div>
            <div class="d-flex align-items-center px-md-3 px-0 mx-md-3 mx-0">
                <img src="~/images/admin-user.png">
                <div class="title2 px-md-2 px-0">@Context.Session.GetString("username")</div>
                <a asp-action="Logout" asp-controller="Home"><img src="~/images/logout.png"></a>
            </div>
        </div>
    </header>
    <section>
        <div class="container-fluid">
            <div class="row">
                <!--sidebar-->
                <div class="card col-lg-2 col-12  p-0 m-0" id="sidemenu">
                    <nav class="navbar navbar-expand-lg navbar-dark">
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-list" aria-controls="navbar-list" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse text-light" id="navbar-list">
                            <ul class="nav nav-tabs flex-column">
                                <li class="nav-item">
                                    <a class="nav-link active" asp-action="ServiceRequests" asp-controller="Home">Service Requests</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" asp-action="UserManagement" asp-controller="Home">User Management</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#ccm">Customer code management</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#cm">Content Management</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#invoices">Invoices</a>
                                </li>
                            </ul>
                        </div>
                    </nav>
                </div>
                <!--sidebar-ends-->
                <!--main-content-->
                <div class="content-right col-lg-10 col-12">

                    <div class="tab-content">
                        <div class="tab-pane p-3" id="ccm">
                            <div class="col">
                                <p>Coupon Code Management</p>
                            </div>
                        </div>
                        <div class="tab-pane p-3" id="cm">
                            <div class="col">
                                <p>Content Management</p>
                            </div>
                        </div>
                        <div class="tab-pane p-3" id="invoices">
                            <div class="col">
                                <p>Invoices</p>
                            </div>
                        </div>
                        <!-------------Service-Request----------->
                        <div class="tab-pane active" id="sr">
                            <div class="col">
                                <div class="tableabove ps-2 pt-3">
                                    <p class="text1 fw-bold">Service Requests</p>
                                </div>
                                <!----------------search-bar--------------->
                                <div class="search-bar p-2">

                                    <form>
                                        <div class="mb-3 d-flex flex-md-row flex-column gap-2">

                                            <input class="serviceid py-2 ps-2" type="text" placeholder="Service ID" id="srid">

                                            <input class="zipcode py-2 ps-2" type="text" placeholder="Postalcode" id="zip">

                                            <input type="email" placeholder="Email" class="username p-2" id="email">

                                            <input type="text" placeholder="Customer" class="username p-2" id="cust">

                                            <input type="text" placeholder="Service Provider" class="username p-2" id="sp">

                                        </div>
                                        <div class="mb-3 d-flex flex-md-row flex-column gap-2">
                                            <select class="status form-select" style="width: 200px" id="status">
                                                <option selected value="">Select Status</option>
                                                <option value="New">New</option>
                                                <option value="Cancelled">Cancelled</option>
                                                <option value="Completed">Completed</option>
                                                <option value="Pending">Pending</option>
                                                <option value="Refunded">Refunded</option>
                                                <option value="Expired">Expired</option>
                                                <option value="Rescheduled">Rescheduled</option>
                                            </select>
                                            <select class="status form-select" style="width: 200px">
                                                <option selected>SP Payment Status</option>
                                                <option>Completed</option>
                                                <option>Pending</option>
                                                <option>Refunded</option>
                                            </select>
                                            <input type="checkbox"><label> Has Issue</label>
                                        </div>
                                        <div class="mb-3 d-flex flex-md-row flex-column gap-2">
                                            <input type="text" placeholder="From Date"
                                                   onfocus="(this.type='date')" class="username p-2">
                                            <input type="text" placeholder="To Date"
                                                   onfocus="(this.type='date')" class="username p-2">
                                            <button class="search" type="button" id="search">Search</button>

                                            <button class="clear">Clear</button>
                                        </div>
                                    </form>


                                </div>
                                <!------------------------table---------------------------->
                                <table class="table mb-3 ms-2" id="example">
                                    <thead>
                                        <tr>
                                            <th>Service ID<img class="ms-2" src="~/images/arrows.png"></th>
                                            <th>Service date<img class="ms-2" src="~/images/arrows.png"></th>
                                            <th>Customer details<img class="ms-2" src="~/images/arrows.png"></th>
                                            <th>Service Provider<img class="ms-2" src="~/images/arrows.png"></th>
                                            <th>Status<img class="ms-2" src="~/images/arrows.png"></th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model)
                                        {

                                            <tr>
                                                <td>@item.ServiceId</td>
                                                <td>
                                                    <img class="me-2" src="~/images/calculator.png"><span class="fw-bold">@item.ServiceStartDate.ToShortDateString() </span><br>
                                                    <img class="me-2" src="~/images/time.png"><span>12:00 - 18:00</span>
                                                </td>
                                                <td>
                                                    @item.FirstName @item.LastName<br>
                                                    <img class="me-2" src="~/images/address.png">
                                                    <span>
                                                        @item.AddressLine1 @item.AddressLine2<br>
                                                        @item.PostalCode @item.City
                                                    </span>
                                                </td>
                                                <td>
                                                </td>

                                                @if (@item.Status == 0)
                                                {
                                                    <td><button class="new mt-2">New</button></td>
                                                }
                                                else @if (@item.Status == 1)
                                           {
                                            <td><button class="complete mt-2">Completed</button></td>
                                        }
                                        else @if (@item.Status == 2)
                                       {
                                        <td><button class="cancelled mt-2">Cancelled</button></td>
                                    }
                                    else
                                    {
                                        <td><button class="pending mt-2">Pending</button></td>
                                    }

                                                <td>
                                                    <div class="dropdown">
                                                        <div id="dropdownMenuButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                            <img src="~/images/3-dots.png">
                                                        </div>
                                                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                                            <a class="dropdown-item" id="editmodal" data-id="@item.ServiceRequestId" @*onclick="editreschedule(@item.ServiceRequestId)"*@>Edit & Reschedule</a>
                                                            <a class="dropdown-item" href="#">Refund</a>
                                                            <a class="dropdown-item" href="#">Cancel</a>
                                                            <a class="dropdown-item" href="#">Change SP</a>
                                                            <a class="dropdown-item" href="#">Escalate</a>
                                                            <a class="dropdown-item" href="#">History Log</a>
                                                            <a class="dropdown-item" href="#">Download Invoice</a>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                                <div class="modal fade" id="editreschedule" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">

                                </div>
                                <!---------------------last-line------------------->
                                <div class="last-line ms-2">©2018 Helperland. All rights reserved.</div>
                            </div>
                        </div>

                    </div>
                    <!--main-content-ends-->
                </div>
            </div>
        </div>
    </section>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            var table = $('#example').DataTable({
                "aaSorting": [],
                columnDefs: [{
                    orderable: false,
                    targets: [1, 5]
                }]
            });
            $('.dataTables_length').addClass('bs-select');

            $(document).on('click', "#search", function () {
                table.column(0).search($("#srid").val()).draw();
                console.log('click');
                table.column(2).search($("#cust").val()).draw();
                table.column(2).search($("#zip").val()).draw();
                table.column(3).search($("#sp").val()).draw();
                table.column(4).search($("#status option:selected").val()).draw();
            });
        });
    </script>
    <script>
        $("#editmodal").click(function(){
            $("#editreschedule").load('@Url.Action("EditReschedule", "Home")')
        });
        var srid;
        $(document).on("click", "#editmodal", function () {
            srid = parseInt($(this).attr('data-id'));
            console.log(srid);
        });
        $(document).on('click', '#editmodal', function () {
            $.ajax({
                type: "get",
                url: "@Url.Action("EditReschedule","Home")",
                data: { id: srid },
                success: function (resp) {
                    console.log(resp);
                    $("#editreschedule").html(resp);
                    $("#editreschedule").modal('show');
                },
                error: function (err) {
                    console.log(err);
                    alert("error");
                }
            });
        });

        $(document).on('click', '#updatesr', function () {
            var add = {};
            add.ServiceRequestId = parseInt($("#sid").val());
            add.ServiceStartDate = $("#date").val();
            add.AddressLine1 = $("#Street").val();
            add.AddressLine2 = $("#HouseNumber").val();
            add.PostalCode = $("#postcode").val();
            add.City = $("#location").val();
            add.Comments = $("#why").val();
            console.log(add);
            $.ajax({
                url: '@Url.Action("EditReschedule", "Home")',
                type: 'post',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify(add),
                success: function (resp) {
                    alert("Service has been edited succesfully!!");
                    location.reload();
                },
                error: function (err) {
                    alert("Error while inserting data");
                }
            });
        });

    </script>
</body>
</html>
